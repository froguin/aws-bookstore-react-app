{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport AnalyticsClass from './Analytics';\nimport Amplify, { ConsoleLogger as Logger, Hub } from '@aws-amplify/core';\nvar logger = new Logger('Analytics');\nvar endpointUpdated = false;\nvar authConfigured = false;\nvar analyticsConfigured = false;\nvar _instance = null;\n\nif (!_instance) {\n  logger.debug('Create Analytics Instance');\n  _instance = new AnalyticsClass();\n}\n\nvar Analytics = _instance;\nAmplify.register(Analytics);\nexport default Analytics;\nexport { AnalyticsClass };\nexport * from './Providers';\n\nvar listener = function listener(capsule) {\n  var channel = capsule.channel,\n      payload = capsule.payload,\n      source = capsule.source;\n  logger.debug('on hub capsule ' + channel, payload);\n\n  switch (channel) {\n    case 'auth':\n      authEvent(payload);\n      break;\n\n    case 'storage':\n      storageEvent(payload);\n      break;\n\n    case 'analytics':\n      analyticsEvent(payload);\n      break;\n\n    default:\n      break;\n  }\n};\n\nvar storageEvent = function storageEvent(payload) {\n  var _a = payload.data,\n      attrs = _a.attrs,\n      metrics = _a.metrics;\n  if (!attrs) return;\n\n  if (analyticsConfigured) {\n    Analytics.record({\n      name: 'Storage',\n      attributes: attrs,\n      metrics: metrics\n    }).catch(function (e) {\n      logger.debug('Failed to send the storage event automatically', e);\n    });\n  }\n};\n\nvar authEvent = function authEvent(payload) {\n  var event = payload.event;\n\n  if (!event) {\n    return;\n  }\n\n  switch (event) {\n    case 'signIn':\n      if (authConfigured && analyticsConfigured) {\n        Analytics.record({\n          name: '_userauth.sign_in'\n        }).catch(function (e) {\n          logger.debug('Failed to send the sign in event automatically', e);\n        });\n      }\n\n      break;\n\n    case 'signUp':\n      if (authConfigured && analyticsConfigured) {\n        Analytics.record({\n          name: '_userauth.sign_up'\n        }).catch(function (e) {\n          logger.debug('Failed to send the sign up event automatically', e);\n        });\n      }\n\n      break;\n\n    case 'signOut':\n      break;\n\n    case 'signIn_failure':\n      if (authConfigured && analyticsConfigured) {\n        Analytics.record({\n          name: '_userauth.auth_fail'\n        }).catch(function (e) {\n          logger.debug('Failed to send the sign in failure event automatically', e);\n        });\n      }\n\n      break;\n\n    case 'configured':\n      authConfigured = true;\n\n      if (authConfigured && analyticsConfigured) {\n        sendEvents();\n      }\n\n      break;\n  }\n};\n\nvar analyticsEvent = function analyticsEvent(payload) {\n  var event = payload.event;\n  if (!event) return;\n\n  switch (event) {\n    case 'pinpointProvider_configured':\n      analyticsConfigured = true;\n\n      if (authConfigured && analyticsConfigured) {\n        sendEvents();\n      }\n\n      break;\n  }\n};\n\nvar sendEvents = function sendEvents() {\n  var config = Analytics.configure();\n\n  if (!endpointUpdated && config['autoSessionRecord']) {\n    Analytics.updateEndpoint({\n      immediate: true\n    }).catch(function (e) {\n      logger.debug('Failed to update the endpoint', e);\n    });\n    endpointUpdated = true;\n  }\n\n  Analytics.autoTrack('session', {\n    enable: config['autoSessionRecord']\n  });\n};\n\nHub.listen('auth', listener);\nHub.listen('storage', listener);\nHub.listen('analytics', listener);","map":{"version":3,"mappings":"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","names":["AnalyticsClass","Amplify","ConsoleLogger","Logger","Hub","logger","endpointUpdated","authConfigured","analyticsConfigured","_instance","debug","Analytics","register","listener","payload","source","channel","authEvent","storageEvent","analyticsEvent","attrs","metrics","record","name","attributes","catch","e","event","sendEvents","config","configure","updateEndpoint","immediate","autoTrack","enable","listen"],"sourceRoot":"","sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}