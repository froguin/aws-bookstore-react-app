{"ast":null,"code":"var HTML5_MEDIA_EVENT;\n\n(function (HTML5_MEDIA_EVENT) {\n  HTML5_MEDIA_EVENT[\"PLAY\"] = \"play\";\n  HTML5_MEDIA_EVENT[\"PAUSE\"] = \"pause\";\n  HTML5_MEDIA_EVENT[\"ENDED\"] = \"Ended\";\n})(HTML5_MEDIA_EVENT || (HTML5_MEDIA_EVENT = {}));\n\nvar MEDIA_TYPE;\n\n(function (MEDIA_TYPE) {\n  MEDIA_TYPE[\"IFRAME\"] = \"IFRAME\";\n  MEDIA_TYPE[\"VIDEO\"] = \"VIDEO\";\n  MEDIA_TYPE[\"AUDIO\"] = \"AUDIO\";\n})(MEDIA_TYPE || (MEDIA_TYPE = {}));\n\nvar EVENT_TYPE;\n\n(function (EVENT_TYPE) {\n  EVENT_TYPE[\"PLAY\"] = \"Play\";\n  EVENT_TYPE[\"ENDED\"] = \"Ended\";\n  EVENT_TYPE[\"PAUSE\"] = \"Pause\";\n  EVENT_TYPE[\"TIME_WATCHED\"] = \"TimeWatched\";\n})(EVENT_TYPE || (EVENT_TYPE = {}));\n\nvar MediaAutoTrack =\n/** @class */\nfunction () {\n  function MediaAutoTrack(params, provider) {\n    var _a;\n\n    this.eventActionMapping = (_a = {}, _a[EVENT_TYPE.ENDED] = this.endedEventAction.bind(this), _a[EVENT_TYPE.PLAY] = this.playEventAction.bind(this), _a[EVENT_TYPE.PAUSE] = this.pauseEventAction.bind(this), _a);\n    var eventData = params.eventData;\n    this._params = params;\n    this._mediaElement = document.getElementById(eventData.properties['domElementId']);\n    this._started = false;\n    this._provider = provider;\n    var mediaTrackFunMapping = {\n      IFRAME: this._iframeMediaTracker,\n      VIDEO: this._html5MediaTracker,\n      AUDIO: this._html5MediaTracker\n    };\n\n    mediaTrackFunMapping[this._mediaElement.tagName].bind(this)();\n\n    this._initYoutubeFrame();\n  }\n\n  MediaAutoTrack.prototype._initYoutubeFrame = function () {\n    this._youTubeIframeLoader = {\n      src: 'https://www.youtube.com/iframe_api',\n      loading: false,\n      loaded: false,\n      listeners: [],\n      load: function load(callback) {\n        var _this = this;\n\n        this.listeners.push(callback);\n\n        if (this.loaded) {\n          setTimeout(function () {\n            _this.done();\n          });\n          return;\n        }\n\n        if (this.loading) {\n          return;\n        }\n\n        this.loading = true;\n\n        window['onYouTubeIframeAPIReady'] = function () {\n          _this.loaded = true;\n\n          _this.done();\n        };\n\n        var script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src = this.src;\n        document.body.appendChild(script);\n      },\n      done: function done() {\n        delete window['onYouTubeIframeAPIReady'];\n\n        while (this.listeners.length) {\n          this.listeners.pop()(window['YT']);\n        }\n      }\n    };\n  };\n\n  MediaAutoTrack.prototype._iframeMediaTracker = function () {\n    var that = this;\n    setInterval(function () {\n      if (that._started) {\n        that.recordEvent(MEDIA_TYPE.IFRAME, EVENT_TYPE.TIME_WATCHED);\n      }\n    }, 3 * 1000);\n\n    this._youTubeIframeLoader.load(function (YT) {\n      that._iframePlayer = new YT.Player(that._mediaElement.id, {\n        events: {\n          onStateChange: that._onPlayerStateChange.bind(that)\n        }\n      });\n    });\n  };\n\n  MediaAutoTrack.prototype._onPlayerStateChange = function (event) {\n    var iframeEventMapping = {\n      0: EVENT_TYPE.ENDED,\n      1: EVENT_TYPE.PLAY,\n      2: EVENT_TYPE.PAUSE\n    };\n    var eventType = iframeEventMapping[event.data];\n\n    if (eventType) {\n      this.eventActionMapping[eventType](MEDIA_TYPE.IFRAME);\n    }\n  };\n\n  MediaAutoTrack.prototype._html5MediaTracker = function () {\n    var that = this;\n    setInterval(function () {\n      if (that._started) {\n        that.recordEvent(MEDIA_TYPE.VIDEO, EVENT_TYPE.TIME_WATCHED);\n      }\n    }, 3 * 1000);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.PLAY, function () {\n      that.eventActionMapping[EVENT_TYPE.PLAY](MEDIA_TYPE.VIDEO);\n    }, false);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.PAUSE, function () {\n      that.eventActionMapping[EVENT_TYPE.PAUSE](MEDIA_TYPE.VIDEO);\n    }, false);\n\n    this._mediaElement.addEventListener(HTML5_MEDIA_EVENT.ENDED, function () {\n      that.eventActionMapping[EVENT_TYPE.ENDED](MEDIA_TYPE.VIDEO);\n    }, false);\n  };\n\n  MediaAutoTrack.prototype.playEventAction = function (mediaType) {\n    this._started = true;\n    this.recordEvent(mediaType, EVENT_TYPE.PLAY);\n  };\n\n  MediaAutoTrack.prototype.pauseEventAction = function (mediaType) {\n    this._started = false;\n    this.recordEvent(mediaType, EVENT_TYPE.PAUSE);\n  };\n\n  MediaAutoTrack.prototype.endedEventAction = function (mediaType) {\n    this._started = false;\n    this.recordEvent(mediaType, EVENT_TYPE.ENDED);\n  };\n\n  MediaAutoTrack.prototype.recordEvent = function (mediaType, eventType) {\n    var newParams = Object.assign({}, this._params);\n    var eventData = newParams.eventData;\n    eventData.eventType = eventType;\n\n    if (mediaType === MEDIA_TYPE.VIDEO) {\n      eventData.properties.timestamp = this._mediaElement.currentTime;\n      eventData.properties.duration = this._mediaElement.duration;\n    } else {\n      eventData.properties.timestamp = this._financial(this._iframePlayer.getCurrentTime());\n      eventData.properties.duration = this._financial(this._iframePlayer.getDuration());\n    }\n\n    var percentage = parseFloat(eventData.properties.timestamp) / parseFloat(eventData.properties.duration);\n    eventData.properties.eventValue = Number(percentage.toFixed(4));\n    delete eventData.properties.domElementId;\n\n    this._provider.putToBuffer(newParams);\n  };\n\n  MediaAutoTrack.prototype._financial = function (x) {\n    return Number.parseFloat(x).toFixed(4);\n  };\n\n  return MediaAutoTrack;\n}();\n\nexport { MediaAutoTrack };","map":{"version":3,"mappings":"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","names":["HTML5_MEDIA_EVENT","MEDIA_TYPE","EVENT_TYPE","params","provider","_a","ENDED","endedEventAction","bind","PLAY","playEventAction","PAUSE","pauseEventAction","_params","_mediaElement","document","getElementById","eventData","properties","_started","_provider","mediaTrackFunMapping","IFRAME","_iframeMediaTracker","VIDEO","_html5MediaTracker","AUDIO","tagName","_initYoutubeFrame","MediaAutoTrack","_youTubeIframeLoader","src","loading","loaded","listeners","load","callback","_this","push","setTimeout","done","window","script","createElement","type","body","appendChild","length","pop","that","setInterval","recordEvent","TIME_WATCHED","YT","_iframePlayer","Player","id","events","onStateChange","_onPlayerStateChange","event","iframeEventMapping","eventType","data","eventActionMapping","addEventListener","mediaType","newParams","Object","assign","timestamp","currentTime","duration","_financial","getCurrentTime","getDuration","percentage","parseFloat","eventValue","Number","toFixed","domElementId","putToBuffer","x"],"sourceRoot":"","sources":["../../../src/Providers/AmazonPersonalizeHelper/MediaAutoTrack.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}