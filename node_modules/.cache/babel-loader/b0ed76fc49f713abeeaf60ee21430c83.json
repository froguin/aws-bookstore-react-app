{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n// import '../Common/Polyfills';\n\n\nimport * as Observable from 'zen-observable';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport { INTERNAL_AWS_APPSYNC_PUBSUB_PROVIDER } from '@aws-amplify/core/lib/constants';\nimport { AWSAppSyncProvider } from './Providers';\nvar logger = new Logger('PubSub');\n\nvar PubSub =\n/** @class */\nfunction () {\n  /**\n   * Initialize PubSub with AWS configurations\n   *\n   * @param {PubSubOptions} options - Configuration object for PubSub\n   */\n  function PubSub(options) {\n    this._options = options;\n    logger.debug('PubSub Options', this._options);\n    this._pluggables = [];\n    this.subscribe = this.subscribe.bind(this);\n  }\n\n  Object.defineProperty(PubSub.prototype, \"awsAppSyncProvider\", {\n    /**\n     * Lazy instantiate awsAppSyncProvider when it is required by the API category\n     */\n    get: function get() {\n      if (!this._awsAppSyncProvider) {\n        this._awsAppSyncProvider = new AWSAppSyncProvider(this._options);\n      }\n\n      return this._awsAppSyncProvider;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  PubSub.prototype.getModuleName = function () {\n    return 'PubSub';\n  };\n  /**\n   * Configure PubSub part with configurations\n   *\n   * @param {PubSubOptions} config - Configuration for PubSub\n   * @return {Object} - The current configuration\n   */\n\n\n  PubSub.prototype.configure = function (options) {\n    var _this = this;\n\n    var opt = options ? options.PubSub || options : {};\n    logger.debug('configure PubSub', {\n      opt: opt\n    });\n    this._options = Object.assign({}, this._options, opt);\n\n    this._pluggables.map(function (pluggable) {\n      return pluggable.configure(_this._options);\n    });\n\n    return this._options;\n  };\n  /**\n   * add plugin into Analytics category\n   * @param {Object} pluggable - an instance of the plugin\n   */\n\n\n  PubSub.prototype.addPluggable = function (pluggable) {\n    return __awaiter(this, void 0, void 0, function () {\n      var config;\n      return __generator(this, function (_a) {\n        if (pluggable && pluggable.getCategory() === 'PubSub') {\n          this._pluggables.push(pluggable);\n\n          config = pluggable.configure(this._options);\n          return [2\n          /*return*/\n          , config];\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  PubSub.prototype.getProviderByName = function (providerName) {\n    if (providerName === INTERNAL_AWS_APPSYNC_PUBSUB_PROVIDER) {\n      return this.awsAppSyncProvider;\n    }\n\n    return this._pluggables.find(function (pluggable) {\n      return pluggable.getProviderName() === providerName;\n    });\n  };\n\n  PubSub.prototype.getProviders = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var providerName = options.provider;\n\n    if (!providerName) {\n      return this._pluggables;\n    }\n\n    var provider = this.getProviderByName(providerName);\n\n    if (!provider) {\n      throw new Error(\"Could not find provider named \" + providerName);\n    }\n\n    return [provider];\n  };\n\n  PubSub.prototype.publish = function (topics, msg, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , Promise.all(this.getProviders(options).map(function (provider) {\n          return provider.publish(topics, msg, options);\n        }))];\n      });\n    });\n  };\n\n  PubSub.prototype.subscribe = function (topics, options) {\n    logger.debug('subscribe options', options);\n    var providers = this.getProviders(options);\n    return new Observable(function (observer) {\n      var observables = providers.map(function (provider) {\n        return {\n          provider: provider,\n          observable: provider.subscribe(topics, options)\n        };\n      });\n      var subscriptions = observables.map(function (_a) {\n        var provider = _a.provider,\n            observable = _a.observable;\n        return observable.subscribe({\n          start: console.error,\n          next: function next(value) {\n            return observer.next({\n              provider: provider,\n              value: value\n            });\n          },\n          error: function error(_error) {\n            return observer.error({\n              provider: provider,\n              error: _error\n            });\n          }\n        });\n      });\n      return function () {\n        return subscriptions.forEach(function (subscription) {\n          return subscription.unsubscribe();\n        });\n      };\n    });\n  };\n\n  return PubSub;\n}();\n\nexport default PubSub;","map":{"version":3,"mappings":"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","names":["Observable","ConsoleLogger","Logger","INTERNAL_AWS_APPSYNC_PUBSUB_PROVIDER","AWSAppSyncProvider","logger","options","_options","debug","_pluggables","subscribe","bind","Object","PubSub","_awsAppSyncProvider","opt","assign","map","configure","_this","pluggable","getCategory","push","config","providerName","awsAppSyncProvider","find","getProviderName","provider","getProviderByName","Error","topics","msg","Promise","all","getProviders","publish","providers","observables","observable","subscriptions","_a","start","console","error","next","value","forEach","unsubscribe"],"sourceRoot":"","sources":["../src/PubSub.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}