{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nimport { ConsoleLogger as Logger } from './Logger';\nvar logger = new Logger('Hub');\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\n\nfunction isLegacyCallback(callback) {\n  return callback.onHubCapsule !== undefined;\n}\n\nvar HubClass =\n/** @class */\nfunction () {\n  function HubClass(name) {\n    this.listeners = [];\n    this.patterns = [];\n    this.protectedChannels = ['core', 'auth', 'api', 'analytics', 'interactions', 'pubsub', 'storage', 'xr'];\n    this.name = name;\n  } // Note - Need to pass channel as a reference for removal to work and not anonymous function\n\n\n  HubClass.prototype.remove = function (channel, listener) {\n    if (channel instanceof RegExp) {\n      var pattern_1 = this.patterns.find(function (_a) {\n        var pattern = _a.pattern;\n        return pattern.source === channel.source;\n      });\n\n      if (!pattern_1) {\n        logger.warn(\"No listeners for \" + channel);\n        return;\n      }\n\n      this.patterns = __spreadArrays(this.patterns.filter(function (x) {\n        return x !== pattern_1;\n      }));\n    } else {\n      var holder = this.listeners[channel];\n\n      if (!holder) {\n        logger.warn(\"No listeners for \" + channel);\n        return;\n      }\n\n      this.listeners[channel] = __spreadArrays(holder.filter(function (_a) {\n        var callback = _a.callback;\n        return callback !== listener;\n      }));\n    }\n  };\n\n  HubClass.prototype.dispatch = function (channel, payload, source, ampSymbol) {\n    if (source === void 0) {\n      source = '';\n    }\n\n    if (this.protectedChannels.indexOf(channel) > -1) {\n      var hasAccess = ampSymbol === AMPLIFY_SYMBOL;\n\n      if (!hasAccess) {\n        logger.warn(\"WARNING: \" + channel + \" is protected and dispatching on it can have unintended consequences\");\n      }\n    }\n\n    var capsule = {\n      channel: channel,\n      payload: __assign({}, payload),\n      source: source,\n      patternInfo: []\n    };\n\n    try {\n      this._toListeners(capsule);\n    } catch (e) {\n      logger.error(e);\n    }\n  };\n\n  HubClass.prototype.listen = function (channel, callback, listenerName) {\n    if (listenerName === void 0) {\n      listenerName = 'noname';\n    }\n\n    var cb; // Check for legacy onHubCapsule callback for backwards compatability\n\n    if (isLegacyCallback(callback)) {\n      logger.warn(\"WARNING onHubCapsule is Deprecated. Please pass in a callback.\");\n      cb = callback.onHubCapsule.bind(callback);\n    } else if (typeof callback !== 'function') {\n      throw new Error('No callback supplied to Hub');\n    } else {\n      cb = callback;\n    }\n\n    if (channel instanceof RegExp) {\n      this.patterns.push({\n        pattern: channel,\n        callback: cb\n      });\n    } else {\n      var holder = this.listeners[channel];\n\n      if (!holder) {\n        holder = [];\n        this.listeners[channel] = holder;\n      }\n\n      holder.push({\n        name: listenerName,\n        callback: cb\n      });\n    }\n  };\n\n  HubClass.prototype._toListeners = function (capsule) {\n    var channel = capsule.channel,\n        payload = capsule.payload;\n    var holder = this.listeners[channel];\n\n    if (holder) {\n      holder.forEach(function (listener) {\n        logger.debug(\"Dispatching to \" + channel + \" with \", payload);\n\n        try {\n          listener.callback(capsule);\n        } catch (e) {\n          logger.error(e);\n        }\n      });\n    }\n\n    if (this.patterns.length > 0) {\n      if (!payload.message) {\n        logger.warn(\"Cannot perform pattern matching without a message key\");\n        return;\n      }\n\n      var payloadStr_1 = payload.message;\n      this.patterns.forEach(function (pattern) {\n        var match = payloadStr_1.match(pattern.pattern);\n\n        if (match) {\n          var groups = match.slice(1);\n\n          var dispatchingCapsule = __assign(__assign({}, capsule), {\n            patternInfo: groups\n          });\n\n          try {\n            pattern.callback(dispatchingCapsule);\n          } catch (e) {\n            logger.error(e);\n          }\n        }\n      });\n    }\n  };\n\n  return HubClass;\n}();\n\nexport { HubClass };\n/*We export a __default__ instance of HubClass to use it as a\npsuedo Singleton for the main messaging bus, however you can still create\nyour own instance of HubClass() for a separate \"private bus\" of events.*/\n\nvar Hub = new HubClass('__default__');\nexport default Hub;","map":{"version":3,"mappings":"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","names":["ConsoleLogger","Logger","logger","AMPLIFY_SYMBOL","Symbol","for","isLegacyCallback","callback","onHubCapsule","undefined","name","HubClass","channel","listener","RegExp","pattern_1","patterns","find","_a","pattern","source","warn","__spreadArrays","filter","holder","listeners","payload","ampSymbol","protectedChannels","indexOf","hasAccess","capsule","patternInfo","_toListeners","e","error","listenerName","cb","bind","Error","push","forEach","debug","length","message","payloadStr_1","match","dispatchingCapsule","groups","Hub"],"sourceRoot":"","sources":["../src/Hub.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}